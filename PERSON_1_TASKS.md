# üë§ –ó–∞–¥–∞—á–∏ –¥–ª—è –ß–µ–ª–æ–≤–µ–∫–∞ 1: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

## –í–∞—à–∞ —Ä–æ–ª—å: –§—É–Ω–¥–∞–º–µ–Ω—Ç –ø—Ä–æ–µ–∫—Ç–∞

–í—ã –æ—Ç–≤–µ—á–∞–µ—Ç–µ –∑–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞ –∏ —Å–∏—Å—Ç–µ–º—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ.

---

## üìÅ –í–∞—à–∏ —Ñ–∞–π–ª—ã:

1. `src/base_communicator.py`
2. `src/errors/__init__.py`
3. `src/errors/communication_error.py`
4. `src/errors/file_access_error.py`

---

## ‚úÖ –ó–∞–¥–∞—á–∞ 1: –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ

**–§–∞–π–ª:** `src/errors/communication_error.py`

```python
"""
–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏.
"""


class CommunicationError(Exception):
    """–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏."""
    pass
```

---

## ‚úÖ –ó–∞–¥–∞—á–∞ 2: –°–æ–∑–¥–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –æ—à–∏–±–æ–∫ —Ñ–∞–π–ª–∞

**–§–∞–π–ª:** `src/errors/file_access_error.py`

```python
"""
–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –æ—à–∏–±–æ–∫ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É.
"""

from src.errors.communication_error import CommunicationError


class FileAccessError(CommunicationError):
    """–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –æ—à–∏–±–æ–∫ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É."""
    pass
```

---

## ‚úÖ –ó–∞–¥–∞—á–∞ 3: –°–æ–∑–¥–∞—Ç—å __init__.py –¥–ª—è –æ—à–∏–±–æ–∫

**–§–∞–π–ª:** `src/errors/__init__.py`

```python
"""
–ú–æ–¥—É–ª—å —Å –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã ping-pong.
"""

from src.errors.communication_error import CommunicationError
from src.errors.file_access_error import FileAccessError

__all__ = [
    'CommunicationError',
    'FileAccessError',
]
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –û—Å—Ç–∞–ª—å–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥–æ–±–∞–≤–∏—Ç –ß–µ–ª–æ–≤–µ–∫ 2

---

## ‚úÖ –ó–∞–¥–∞—á–∞ 4: –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å BaseCommunicator

**–§–∞–π–ª:** `src/base_communicator.py`

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

1. **–ò–º–ø–æ—Ä—Ç—ã:**
```python
import os
from datetime import datetime
from typing import Optional
from abc import ABC, abstractmethod

from src.errors import FileAccessError
```

2. **–ö–ª–∞—Å—Å BaseCommunicator (–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π):**

**–ê—Ç—Ä–∏–±—É—Ç—ã:**
- `shared_file: str` - –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
- `_role: str` - —Ä–æ–ª—å –ø—Ä–æ—Ü–µ—Å—Å–∞ (CLIENT/SERVER)

**–ú–µ—Ç–æ–¥—ã:**

### `__init__(self, shared_file: str)`
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
- –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–æ–ª—å –∏–∑ –∏–º–µ–Ω–∏ –∫–ª–∞—Å—Å–∞: `self.__class__.__name__.replace("PingPong", "").upper()`

### `_log(self, message: str)`
- –ü–æ–ª—É—á–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É: `datetime.now().strftime("%H:%M:%S.%f")[:-3]`
- –í—ã–≤–µ—Å—Ç–∏: `[timestamp] [ROLE] message`

### `@abstractmethod _change_state(self, new_state)`
- –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –º–µ—Ç–æ–¥ (–±–µ–∑ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
- –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–ª–∞—Å—Å–∞—Ö

### `_read_file(self) -> Optional[str]`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ `os.path.exists()`
- –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –≤–µ—Ä–Ω—É—Ç—å `None`
- –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª –≤ —Ä–µ–∂–∏–º–µ —á—Ç–µ–Ω–∏—è ('r', encoding='utf-8')
- –ü—Ä–æ—á–∏—Ç–∞—Ç—å –∏ —É–±—Ä–∞—Ç—å –ø—Ä–æ–±–µ–ª—ã —á–µ—Ä–µ–∑ `.strip()`
- –í–µ—Ä–Ω—É—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–ª–∏ `None` –µ—Å–ª–∏ –ø—É—Å—Ç–æ
- –ü—Ä–∏ –æ—à–∏–±–∫–µ IOError –≤—ã–±—Ä–æ—Å–∏—Ç—å `FileAccessError`

### `_write_file(self, content: str)`
- –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª –≤ —Ä–µ–∂–∏–º–µ –∑–∞–ø–∏—Å–∏ ('w', encoding='utf-8')
- –ó–∞–ø–∏—Å–∞—Ç—å `content + "\n"`
- –í—ã–∑–≤–∞—Ç—å `f.flush()` –∏ `os.fsync(f.fileno())` –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞–ø–∏—Å–∏
- –ü—Ä–∏ –æ—à–∏–±–∫–µ IOError –≤—ã–±—Ä–æ—Å–∏—Ç—å `FileAccessError`

### `_clear_file(self)`
- –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª –≤ —Ä–µ–∂–∏–º–µ –∑–∞–ø–∏—Å–∏
- –ó–∞–ø–∏—Å–∞—Ç—å –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É `""`
- –ó–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å "Cleared shared file"
- –ü—Ä–∏ –æ—à–∏–±–∫–µ IOError –≤—ã–±—Ä–æ—Å–∏—Ç—å `FileAccessError`

### `_remove_file(self)`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
- –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —É–¥–∞–ª–∏—Ç—å —á–µ—Ä–µ–∑ `os.remove()`
- –ó–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å "Removed file: {–ø—É—Ç—å}"
- –ü—Ä–∏ –æ—à–∏–±–∫–µ IOError –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (–Ω–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ!)

### `_file_exists(self) -> bool`
- –í–µ—Ä–Ω—É—Ç—å `os.path.exists(self.shared_file)`

---

## üìã –®–∞–±–ª–æ–Ω –∫–æ–¥–∞ –¥–ª—è BaseCommunicator:

```python
"""
–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞.
–°–æ–¥–µ—Ä–∂–∏—Ç –æ–±—â—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–æ–≤—ã–º –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–º.
"""

import os
from datetime import datetime
from typing import Optional
from abc import ABC, abstractmethod

from src.errors import FileAccessError


class BaseCommunicator(ABC):
    """
    –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞.
    –ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –æ–±—â—É—é –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–æ–º –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º.
    """

    def __init__(self, shared_file: str):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑–æ–≤–æ–≥–æ –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä–∞.

        Args:
            shared_file: –ü—É—Ç—å –∫ –æ–±—â–µ–º—É —Ñ–∞–π–ª—É –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
        """
        # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
        pass

    def _log(self, message: str):
        """
        –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π –∏ —Ä–æ–ª—å—é.

        Args:
            message: –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        """
        # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
        pass

    @abstractmethod
    def _change_state(self, new_state):
        """
        –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è.
        –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–ª–∞—Å—Å–∞—Ö.

        Args:
            new_state: –ù–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        """
        pass

    def _read_file(self) -> Optional[str]:
        """
        –ß—Ç–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏–∑ –æ–±—â–µ–≥–æ —Ñ–∞–π–ª–∞.

        Returns:
            –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –∏–ª–∏ None –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç/–ø—É—Å—Ç

        Raises:
            FileAccessError: –ü—Ä–∏ –æ—à–∏–±–∫–µ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞
        """
        # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
        pass

    def _write_file(self, content: str):
        """
        –ó–∞–ø–∏—Å—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –≤ –æ–±—â–∏–π —Ñ–∞–π–ª —Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π.

        Args:
            content: –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è –∑–∞–ø–∏—Å–∏

        Raises:
            FileAccessError: –ü—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–ø–∏—Å–∏ –≤ —Ñ–∞–π–ª
        """
        # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
        pass

    def _clear_file(self):
        """
        –û—á–∏—Å—Ç–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –æ–±—â–µ–≥–æ —Ñ–∞–π–ª–∞.

        Raises:
            FileAccessError: –ü—Ä–∏ –æ—à–∏–±–∫–µ –æ—á–∏—Å—Ç–∫–∏ —Ñ–∞–π–ª–∞
        """
        # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
        pass

    def _remove_file(self):
        """
        –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—â–µ–≥–æ —Ñ–∞–π–ª–∞.
        """
        # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
        pass

    def _file_exists(self) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –æ–±—â–µ–≥–æ —Ñ–∞–π–ª–∞.

        Returns:
            True –µ—Å–ª–∏ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, False –∏–Ω–∞—á–µ
        """
        # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
        pass
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:

- [ ] –í—Å–µ 4 —Ñ–∞–π–ª–∞ —Å–æ–∑–¥–∞–Ω—ã
- [ ] `CommunicationError` –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç `Exception`
- [ ] `FileAccessError` –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç `CommunicationError`
- [ ] `BaseCommunicator` —è–≤–ª—è–µ—Ç—Å—è –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–º –∫–ª–∞—Å—Å–æ–º (–Ω–∞—Å–ª–µ–¥—É–µ—Ç `ABC`)
- [ ] –ú–µ—Ç–æ–¥ `_change_state` –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ `@abstractmethod`
- [ ] –í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ—à–∏–±–∫–∏
- [ ] –ú–µ—Ç–æ–¥ `_write_file` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `os.fsync()` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- [ ] –í—Å–µ –º–µ—Ç–æ–¥—ã –∏–º–µ—é—Ç docstring
- [ ] –ö–æ–¥ —Å–ª–µ–¥—É–µ—Ç PEP 8

---

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª `test_base.py`:

```python
from src.base_communicator import BaseCommunicator

class TestCommunicator(BaseCommunicator):
    def _change_state(self, new_state):
        print(f"State changed to: {new_state}")

# –¢–µ—Å—Ç
comm = TestCommunicator("test.txt")
comm._write_file("Hello, World!")
content = comm._read_file()
print(f"Read: {content}")
comm._remove_file()
```

–î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏:
```
[HH:MM:SS.mmm] [TESTCOMMUNICATOR] Request sent...
Read: Hello, World!
[HH:MM:SS.mmm] [TESTCOMMUNICATOR] Removed file: test.txt
```

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:

- [ABC - –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –∫–ª–∞—Å—Å—ã](https://docs.python.org/3/library/abc.html)
- [os.fsync() - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–∞](https://docs.python.org/3/library/os.html#os.fsync)
- [–†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏ –≤ Python](https://docs.python.org/3/tutorial/inputoutput.html#reading-and-writing-files)
